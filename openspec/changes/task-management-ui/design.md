## Context

AgentForge already has a complete task backend:
- **Task dataobject** (`task-dataobject`) with full CRUD API
- **Auto-increment keys** via `autoIncrement` config (AF-1, AF-2, etc.)
- **Schema fields:** id, projectId, key, title, description, type, priority, status, assignee
- **REST API** at `/api/tasks` with filtering by projectId

What's missing is any UI to interact with tasks. Currently, tasks can only be:
- Created via direct API calls
- Viewed in database table view (read-only)
- Not manageable by end users

The goal is to build a modern task management UI comparable to Linear, Jira, or GitHub Issues, but integrated directly into AgentForge.

## Goals / Non-Goals

**Goals:**
- Full task CRUD (create, read, update, delete) with intuitive UI
- Kanban board for visual task management
- Drag-and-drop to change status
- Filtering and search
- Keyboard accessibility
- Reusable components in `@agentforge/ui-components`

**Non-Goals:**
- Multi-project task views (tasks are scoped to single project)
- Real-time collaboration (future)
- Task comments/attachments (future)
- Advanced workflow customization (future)
- Gantt charts or timeline views (future)
- Task dependencies (future)

## Decisions

### Decision 1: Kanban board vs list view as primary interface
**Choice:** Kanban board as primary view, with list view as secondary option

**Rationale:**
- Kanban is more visual and intuitive for status-based workflow
- Drag-and-drop makes status updates natural
- Better at-a-glance overview of work distribution
- Aligns with modern project management tools (Linear, Trello, Notion)

**Alternative considered:** List view as primary
- More compact, shows more tasks
- Better for text-heavy tasks
- Simpler to implement

**Implementation:** Build both, but default to board view. Allow toggle between views.

### Decision 2: Drag-and-drop library
**Choice:** Use `@dnd-kit/core` for drag-and-drop

**Rationale:**
- Modern, well-maintained library
- Excellent accessibility support (keyboard navigation built-in)
- Performant (uses CSS transforms)
- Works with React 18/19
- Supports both mouse and touch

**Alternative considered:** `react-beautiful-dnd`
- Popular but not actively maintained
- No React 18 support
- Performance issues with large lists

**Alternative considered:** HTML5 drag-and-drop API
- Browser native but poor UX
- Inconsistent across browsers
- No built-in accessibility

### Decision 3: Task form approach
**Choice:** Modal dialog for create, inline editing for updates

**Rationale:**
- Modal creates clear focus on task creation (fewer mistakes)
- Inline editing makes quick updates fast
- Matches user expectations from similar tools

**Alternative considered:** Always inline
- Faster for power users
- More error-prone for complex tasks
- Harder to validate before submission

**Alternative considered:** Always modal
- More consistent
- Slower workflow for quick edits

### Decision 4: Auto-key generation UI treatment
**Choice:** Hide key field entirely in create form, display prominently after creation

**Rationale:**
- Keys are auto-generated by backend, no user input needed
- Showing disabled field clutters UI
- Generated key is prominently displayed in confirmation toast

**Alternative considered:** Show disabled key field with "(Auto-generated)" placeholder
- More explicit about key existence
- Clutters form unnecessarily

**Alternative considered:** Let user optionally specify key
- Violates auto-increment contract
- Allows conflicts and errors
- Not worth the complexity

### Decision 5: Component architecture
**Choice:** Build reusable components in `@agentforge/ui-components`, compose in `agentforge-ui`

**Components in ui-components:**
- `TaskBoard` - Kanban board layout and drag-and-drop
- `TaskCard` - Individual task card for board
- `TaskForm` - Create/edit form
- `TaskDetailPanel` - Full task details view
- `TaskList` - List view (alternative to board)

**Components in agentforge-ui:**
- `TasksPage` - Main page that composes board/list views
- Integration with ProjectViewer routing

**Rationale:**
- Reusable components can be used in other UIs (demo-ui, future dashboards)
- Clear separation: ui-components = generic, agentforge-ui = app-specific
- Easier to test components in isolation

### Decision 6: Filtering and search implementation
**Choice:** Client-side filtering of already-loaded tasks

**Rationale:**
- Simpler implementation (no API changes needed)
- Faster user experience (instant results)
- Acceptable for typical task counts (< 100 tasks per project)

**Alternative considered:** Server-side filtering via API query params
- Better for large datasets
- More complex implementation
- Requires API updates
- Can add later if needed (progressive enhancement)

**Implementation:**
- Load all tasks for current project on mount
- Filter/search in React state
- If performance becomes issue, add pagination + server-side filtering

### Decision 7: Status column configuration
**Choice:** Hard-code 5 standard status columns (todo, in-progress, review, done, blocked)

**Rationale:**
- Matches existing task dataobject enum
- Simple, predictable workflow
- Sufficient for most agile workflows

**Alternative considered:** User-configurable columns
- More flexible
- Much more complex (drag columns, create custom statuses)
- Overkill for MVP

**Future enhancement:** Allow projects to customize which statuses are active

## Architecture

### Component Hierarchy

```
TasksPage (agentforge-ui)
├── TaskViewToggle (board/list)
├── TaskFilters
│   ├── AssigneeFilter
│   ├── PriorityFilter
│   ├── TypeFilter
│   └── SearchBox
├── TaskBoard (@agentforge/ui-components)
│   ├── TaskColumn (x5: todo, in-progress, review, done, blocked)
│   │   ├── TaskCard (x N)
│   │   └── AddTaskButton
│   └── DragOverlay
└── TaskDetailPanel (conditional, slides in from right)
    ├── TaskHeader (key, title, status)
    ├── TaskMetadata (assignee, priority, type, dates)
    ├── TaskDescription
    ├── TaskActions (edit, delete)
    └── LinkedSessions (future)
```

### Data Flow

**Loading tasks:**
```
TasksPage mounts
  → useEffect calls GET /api/tasks?projectId={id}
  → Store tasks in React state
  → Pass to TaskBoard as props
```

**Creating task:**
```
User clicks "New Task"
  → TaskForm modal opens
  → User submits form
  → POST /api/tasks (key is auto-generated on server)
  → API returns new task with key
  → Add task to React state (optimistic update)
  → Close modal
  → Show toast "Task {key} created"
```

**Updating task status (drag-and-drop):**
```
User drags TaskCard from "todo" to "in-progress"
  → onDragEnd callback fires
  → Update task status in local state (optimistic)
  → PATCH /api/tasks/{id} with new status
  → If API fails, revert local state + show error toast
```

**Deleting task:**
```
User clicks delete icon
  → Confirmation dialog opens
  → User confirms
  → DELETE /api/tasks/{id}
  → Remove from local state
  → Show toast "Task {key} deleted"
```

### API Integration

**Existing endpoints (no changes needed):**
- `GET /api/tasks?projectId={id}` - List all tasks for project
- `POST /api/tasks` - Create task (auto-generates key)
- `PATCH /api/tasks/{id}` - Update task
- `DELETE /api/tasks/{id}` - Delete task

**Optional enhancements (future):**
- `GET /api/tasks?status=todo&assignee=engineer` - Server-side filtering
- `PATCH /api/tasks/{id}/bulk` - Bulk update for reordering

### State Management

**Local React state:**
- Tasks array
- Active filters (assignee, priority, type, search query)
- Selected task (for detail panel)
- View mode (board vs list)

**localStorage persistence:**
- View mode preference
- Filter preferences
- Column collapsed state (future)

No global state management (Redux, Zustand) needed - state is scoped to TasksPage.

## Risks / Trade-offs

**[Risk]** Drag-and-drop may not work well on touch devices
→ **Mitigation:** `@dnd-kit` has touch support, test on mobile, add touch-specific interactions

**[Risk]** Client-side filtering slow with 100+ tasks
→ **Mitigation:** Acceptable for MVP, add server-side filtering + pagination later if needed

**[Risk]** Optimistic updates could cause confusing UX if API fails frequently
→ **Mitigation:** Revert optimistic updates on error, show clear error toast, retry mechanism

**[Trade-off]** No task history/audit log
→ **Acceptable:** Can add later, not critical for MVP

**[Trade-off]** No task dependencies or subtasks
→ **Acceptable:** Adds significant complexity, defer to future

**[Trade-off]** Hard-coded status columns (can't customize workflow)
→ **Acceptable:** Covers 90% of use cases, can make configurable later

## Testing Strategy

**Unit Tests:**
- TaskCard rendering with different priorities, statuses
- TaskForm validation logic
- Filter/search logic in TasksPage
- Auto-key display formatting

**Integration Tests (Playwright):**
- Create task flow: open modal, fill form, verify task appears
- Drag-and-drop: drag task to new column, verify status updates
- Edit task: inline edit title, verify update persists
- Delete task: confirm deletion, verify task removed
- Filters: apply filters, verify correct tasks shown
- Keyboard navigation: navigate board with keyboard, drag with keyboard

**Accessibility Tests:**
- Screen reader announces task status changes
- Keyboard navigation through board
- Focus management (modal open/close, task selection)
- Color contrast for priority indicators

## Future Enhancements

1. **Task comments** - Discussion threads on tasks
2. **Task attachments** - Upload files to tasks
3. **Task dependencies** - Block tasks on other tasks
4. **Subtasks** - Break down tasks into smaller pieces
5. **Custom fields** - Project-specific task metadata
6. **Task templates** - Quickly create common task types
7. **Bulk operations** - Select multiple tasks, bulk edit
8. **Timeline/Gantt view** - Visualize task schedule
9. **Task estimates** - Story points or time estimates
10. **Burndown charts** - Sprint/project progress visualization
